<UserControl x:Class="RetailCorrector.Wizard.UserControls.ReceiptView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:c="clr-namespace:RetailCorrector.Wizard.Converters"
             VerticalAlignment="Top"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Width="190" Background="White" MouseDown="SwitchSelection"
             MouseDoubleClick="OpenDialog">
    <UserControl.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontFamily" Value="Lucida Console"/>
        </Style>
        <c:SimpleCalcConverter x:Key="calc"/>
        <c:BoolValueConverter x:Key="bool"/>
        <c:OperationConverter x:Key="op"/>
        <c:EnumDisplayNameConverter x:Key="corr"/>
    </UserControl.Resources>
    <Canvas Height="{Binding ActualHeight, ConverterParameter=10, Converter={StaticResource calc}, ElementName=panel, Mode=OneWay}"
             DataContext="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}}">
        <StackPanel Margin="5" Width="180" x:Name="panel">
            <TextBlock Text="{Binding DataSource.Operation, Converter={StaticResource op}}" FontSize="13" HorizontalAlignment="Center"/>
            <GridSplitter Height="3"/>
            <DockPanel>
                <TextBlock Text="{Binding DataSource.CorrectionType, Converter={StaticResource corr}}" HorizontalAlignment="Right"/>
                <TextBlock Text="{Binding DataSource.ActNumber}" HorizontalAlignment="Right"/>
            </DockPanel>
            <TextBlock Text="---------------------------"/>
            <ItemsControl ItemsSource="{Binding DataSource.Items}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Margin="2"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="0,1">
                            <TextBlock Text="{Binding Name}" TextWrapping="WrapWithOverflow" BaselineOffset="6"/>
                            <DockPanel Margin="10,0,0,0">
                                <TextBlock Text="{Binding Quantity, Converter={StaticResource calc}, ConverterParameter=/1000}"/>
                                <TextBlock Text=" X "/>
                                <TextBlock Text="{Binding Price, StringFormat='F2', Converter={StaticResource calc}, ConverterParameter=/100}"/>
                                <TextBlock Text="{Binding TotalSum, StringFormat='F2', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right" DockPanel.Dock="Right"/>
                            </DockPanel>
                            <TextBlock Text="-------------------------------------"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <DockPanel>
                <TextBlock Text="ИТОГ" FontWeight="Bold" FontSize="14"/>
                <TextBlock Text="{Binding DataSource.RoundedSum, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right" FontSize="14" FontWeight="Bold"/>
            </DockPanel>
            <DockPanel Visibility="{Binding DataSource.Payment.Cash, Converter={StaticResource bool}, ConverterParameter=!0}">
                <TextBlock Text="НАЛИЧНЫЕ" Margin="5,0,0,0"/>
                <TextBlock Text="{Binding DataSource.Payment.Cash, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right"/>
            </DockPanel>
            <DockPanel Visibility="{Binding DataSource.Payment.ECash, Converter={StaticResource bool}, ConverterParameter=!0}">
                <TextBlock Text="БЕЗНАЛИЧНЫЕ" Margin="5,0,0,0"/>
                <TextBlock Text="{Binding DataSource.Payment.ECash, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right"/>
            </DockPanel>
            <DockPanel Visibility="{Binding DataSource.Payment.Pre, Converter={StaticResource bool}, ConverterParameter=!0}">
                <TextBlock Text="АВАНС" Margin="5,0,0,0"/>
                <TextBlock Text="{Binding DataSource.Payment.Pre, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right"/>
            </DockPanel>
            <DockPanel Visibility="{Binding DataSource.Payment.Post, Converter={StaticResource bool}, ConverterParameter=!0}">
                <TextBlock Text="КРЕДИТ" Margin="5,0,0,0"/>
                <TextBlock Text="{Binding DataSource.Payment.Post, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right"/>
            </DockPanel>
            <DockPanel Visibility="{Binding DataSource.Payment.Provision, Converter={StaticResource bool}, ConverterParameter=!0}">
                <TextBlock Text="ВП" Margin="5,0,0,0"/>
                <TextBlock Text="{Binding DataSource.Payment.Provision, StringFormat='≡{0:F2}', Converter={StaticResource calc}, ConverterParameter=/100}" HorizontalAlignment="Right"/>
            </DockPanel>
            <GridSplitter Height="7"/>
            <TextBlock Text="{Binding DataSource.Created, StringFormat='dd.MM.yy HH:mm'}" HorizontalAlignment="Right"/>
            <TextBlock Text="{Binding DataSource.FiscalSign, StringFormat='ФП: {0}'}" HorizontalAlignment="Right"/>
        </StackPanel>
        <Line X1="0" X2="0" Y1="0" Y2="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}, Path=ActualHeight}" Stroke="Black">
            <Line.Style>
                <Style TargetType="Line">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl, Mode=FindAncestor}, Path=IsSelected}" Value="true">
                            <Setter Property="StrokeThickness" Value="3"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Line.Style>
        </Line>
        <Line X1="190" X2="190" Y1="0" Y2="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}, Path=ActualHeight}" Stroke="Black">
            <Line.Style>
                <Style TargetType="Line">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl, Mode=FindAncestor}, Path=IsSelected}" Value="true">
                            <Setter Property="StrokeThickness" Value="3"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Line.Style>
        </Line>
        <Path Canvas.Bottom="-5" Canvas.Left="0" Fill="White" Stroke="Black"
              Data="M 0 0 L 0 4 L 5 0 L 10 4 L 15 0 L 20 4 L 25 0 L 30 4 L 35 0 L 40 4 L 45 0 L 50 4 L 55 0 L 60 4 L 65 0 L 70 4 L 75 0 L 80 4 L 85 0 L 90 4 L 95 0 L 100 4 L 105 0 L 110 4 L 115 0 L 120 4 L 125 0 L 130 4 L 135 0 L 140 4 L 145 0 L 150 4 L 155 0 L 160 4 L 165 0 L 170 4 L 175 0 L 180 4 L 185 0 L 190 4 L 190 0">
            <Path.Style>
                <Style TargetType="Path">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl, Mode=FindAncestor}, Path=IsSelected}" Value="true">
                            <Setter Property="StrokeThickness" Value="3"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Path.Style>
        </Path>
        <Path Canvas.Top="0" Canvas.Left="0" Fill="White" Stroke="Black"
              Data="M 0 0 L 0 -4 L 5 0 L 10 -4 L 15 0 L 20 -4 L 25 0 L 30 -4 L 35 0 L 40 -4 L 45 0 L 50 -4 L 55 0 L 60 -4 L 65 0 L 70 -4 L 75 0 L 80 -4 L 85 0 L 90 -4 L 95 0 L 100 -4 L 105 0 L 110 -4 L 115 0 L 120 -4 L 125 0 L 130 -4 L 135 0 L 140 -4 L 145 0 L 150 -4 L 155 0 L 160 -4 L 165 0 L 170 -4 L 175 0 L 180 -4 L 185 0 L 190 -4 L 190 0">
            <Path.Style>
                <Style TargetType="Path">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl, Mode=FindAncestor}, Path=IsSelected}" Value="true">
                            <Setter Property="StrokeThickness" Value="3"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Path.Style>
        </Path>
    </Canvas>
</UserControl>
